<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Змейка в лесу</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
  <!-- Музыка -->
  <audio id="bg-music" src="https://cdn.pixabay.com/download/audio/2021/12/20/audio_d25fc6f35b.mp3?filename=forest-ambience-1-20769.mp3" loop autoplay></audio>

  <script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
  <script>
    let scene = new THREE.Scene();
    scene.background = new THREE.Color(0x88cc88);

    let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(10, 10, 20);
    camera.lookAt(0, 0, 0);

    let renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(5, 10, 7.5);
    scene.add(light);

    const snake = [];
    const segmentSize = 1;
    const snakeMaterial = new THREE.MeshLambertMaterial({ color: 0x00ff00 });

    for (let i = 0; i < 5; i++) {
      const segment = new THREE.Mesh(new THREE.BoxGeometry(segmentSize, segmentSize, segmentSize), snakeMaterial);
      segment.position.set(-i, 0, 0);
      snake.push(segment);
      scene.add(segment);
    }

    // Лес
    const treeMaterial = new THREE.MeshLambertMaterial({ color: 0x228833 });
    for (let i = 0; i < 100; i++) {
      const tree = new THREE.Mesh(new THREE.ConeGeometry(0.5, 2, 6), treeMaterial);
      tree.position.set(Math.random() * 40 - 20, 1, Math.random() * 40 - 20);
      scene.add(tree);
    }

    // Фрукт
    const fruitMaterial = new THREE.MeshLambertMaterial({ color: 0xff0000 });
    const fruit = new THREE.Mesh(new THREE.SphereGeometry(0.5, 12, 12), fruitMaterial);
    scene.add(fruit);

    function placeFruit() {
      fruit.position.set(
        Math.floor(Math.random() * 40 - 20),
        0,
        Math.floor(Math.random() * 40 - 20)
      );
    }
    placeFruit();

    // Движение
    let direction = { x: 1, z: 0 };
    let lastMoveTime = 0;
    const speed = 200;

    function animate(time) {
      requestAnimationFrame(animate);

      if (time - lastMoveTime > speed) {
        // переместить сегменты
        for (let i = snake.length - 1; i > 0; i--) {
          snake[i].position.copy(snake[i - 1].position);
        }
        snake[0].position.x += direction.x;
        snake[0].position.z += direction.z;

        // поедание фрукта
        if (snake[0].position.distanceTo(fruit.position) < 1) {
          const newSegment = new THREE.Mesh(new THREE.BoxGeometry(segmentSize, segmentSize, segmentSize), snakeMaterial);
          newSegment.position.copy(snake[snake.length - 1].position);
          snake.push(newSegment);
          scene.add(newSegment);
          placeFruit();
        }

        lastMoveTime = time;
      }

      renderer.render(scene, camera);
    }

    animate(0);

    // Управление
    window.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowUp' && direction.z !== 1) direction = { x: 0, z: -1 };
      if (e.key === 'ArrowDown' && direction.z !== -1) direction = { x: 0, z: 1 };
      if (e.key === 'ArrowLeft' && direction.x !== 1) direction = { x: -1, z: 0 };
      if (e.key === 'ArrowRight' && direction.x !== -1) direction = { x: 1, z: 0 };
    });

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
