import React, { useState } from 'react';
import { Card, CardHeader, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Select } from '@/components/ui/select';

const TestingApp = () => {
  const [step, setStep] = useState(1);
  const [formData, setFormData] = useState({
    fullName: '',
    position: '',
    answers: [],
  });
  const [results, setResults] = useState(null);

  // Пример данных о должностях
  const positions = [
    'Менеджер',
    'Разработчик',
    'Дизайнер',
    'Аналитик',
    'Тестировщик'
  ];

  // Пример вопросов теста
  const questions = [
    {
      id: 1,
      text: 'Какой метод HTTP используется для получения данных?',
      options: ['GET', 'POST', 'PUT', 'DELETE'],
      correctAnswer: 'GET'
    },
    {
      id: 2,
      text: 'Что такое SQL?',
      options: [
        'Язык структурированных запросов',
        'Язык программирования',
        'Фреймворк',
        'Операционная система'
      ],
      correctAnswer: 'Язык структурированных запросов'
    },
    {
      id: 3,
      text: 'Что такое HTML?',
      options: [
        'Язык гипертекстовой разметки',
        'Язык программирования',
        'База данных',
        'Протокол передачи данных'
      ],
      correctAnswer: 'Язык гипертекстовой разметки'
    }
  ];

  const handleInputChange = (e) => {
    setFormData({ ...formData, [e.target.name]: e.target.value });
  };

  const handleAnswerSelect = (questionId, answer) => {
    setFormData({
      ...formData,
      answers: [
        ...formData.answers.filter(a => a.questionId !== questionId),
        { questionId, answer }
      ]
    });
  };

  const calculateResults = () => {
    const results = {
      total: questions.length,
      correct: 0,
      incorrect: [],
    };

    formData.answers.forEach(answer => {
      const question = questions.find(q => q.id === answer.questionId);
      if (question.correctAnswer === answer.answer) {
        results.correct += 1;
      } else {
        results.incorrect.push({
          question: question.text,
          userAnswer: answer.answer,
          correctAnswer: question.correctAnswer
        });
      }
    });

    setResults(results);
    setStep(4);
  };

  const renderStep = () => {
    switch (step) {
      case 1:
        return (
          <div className="space-y-4">
            <h2 className="text-xl font-bold">Персональные данные</h2>
            <Input
              name="fullName"
              placeholder="Введите ФИО"
              value={formData.fullName}
              onChange={handleInputChange}
              className="w-full"
            />
            <Button 
              onClick={() => setStep(2)}
              disabled={!formData.fullName}
              className="w-full"
            >
              Далее
            </Button>
          </div>
        );

      case 2:
        return (
          <div className="space-y-4">
            <h2 className="text-xl font-bold">Выберите должность</h2>
            <select
              name="position"
              value={formData.position}
              onChange={handleInputChange}
              className="w-full p-2 border rounded"
            >
              <option value="">Выберите должность</option>
              {positions.map(pos => (
                <option key={pos} value={pos}>{pos}</option>
              ))}
            </select>
            <Button 
              onClick={() => setStep(3)}
              disabled={!formData.position}
              className="w-full"
            >
              Начать тест
            </Button>
          </div>
        );

      case 3:
        return (
          <div className="space-y-6">
            <h2 className="text-xl font-bold">Тестирование</h2>
            {questions.map(question => (
              <div key={question.id} className="space-y-2">
                <p className="font-medium">{question.text}</p>
                <div className="space-y-2">
                  {question.options.map(option => (
                    <div key={option} className="flex items-center">
                      <input
                        type="radio"
                        name={`question-${question.id}`}
                        value={option}
                        checked={formData.answers.some(a => 
                          a.questionId === question.id && a.answer === option
                        )}
                        onChange={() => handleAnswerSelect(question.id, option)}
                        className="mr-2"
                      />
                      <label>{option}</label>
                    </div>
                  ))}
                </div>
              </div>
            ))}
            <Button 
              onClick={calculateResults}
              disabled={formData.answers.length !== questions.length}
              className="w-full"
            >
              Завершить тест
            </Button>
          </div>
        );

      case 4:
        return (
          <div className="space-y-4">
            <h2 className="text-xl font-bold">Результаты тестирования</h2>
            <div>
              <p className="font-medium">ФИО: {formData.fullName}</p>
              <p className="font-medium">Должность: {formData.position}</p>
              <p className="font-medium">
                Правильных ответов: {results.correct} из {results.total}
                ({((results.correct / results.total) * 100).toFixed(1)}%)
              </p>
            </div>
            {results.incorrect.length > 0 && (
              <div className="mt-4">
                <h3 className="font-bold">Ошибки:</h3>
                {results.incorrect.map((error, index) => (
                  <div key={index} className="mt-2 p-2 bg-red-50 rounded">
                    <p>Вопрос: {error.question}</p>
                    <p className="text-red-500">Ваш ответ: {error.userAnswer}</p>
                    <p className="text-green-500">Правильный ответ: {error.correctAnswer}</p>
                  </div>
                ))}
              </div>
            )}
            <Button 
              onClick={() => {
                setStep(1);
                setFormData({ fullName: '', position: '', answers: [] });
                setResults(null);
              }}
              className="w-full"
            >
              Пройти тест заново
            </Button>
          </div>
        );
    }
  };

  return (
    <Card className="w-full max-w-2xl mx-auto">
      <CardHeader>
        <h1 className="text-2xl font-bold text-center">Система тестирования сотрудников</h1>
      </CardHeader>
      <CardContent>
        {renderStep()}
      </CardContent>
    </Card>
  );
};

export default TestingApp;
